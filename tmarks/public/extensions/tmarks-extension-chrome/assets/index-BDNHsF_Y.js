import{S as e}from"./urls-DUfIfy6Z.js";import{o as s,k as a,r as n}from"./react-vendor-1ZtHTM4k.js";const i=s((s,a)=>({currentPage:null,recommendedTags:[],existingTags:[],selectedTags:[],isLoading:!1,isSaving:!1,isRecommending:!1,error:null,successMessage:null,loadingMessage:null,lastRecommendationSource:null,lastRecommendationMessage:null,lastSaveDurationMs:null,lastRecommendationDurationMs:null,isPublic:!0,includeThumbnail:!1,createSnapshot:!1,existingBookmark:null,setExistingBookmark:e=>s({existingBookmark:e}),config:null,setCurrentPage:e=>s(s=>{let a=!1;const n=s.config?.preferences.defaultIncludeThumbnail??!0;return e&&(a=s.currentPage&&s.currentPage.url===e.url?s.includeThumbnail&&Boolean(e.thumbnail):n&&Boolean(e.thumbnail)),{currentPage:e,includeThumbnail:a}}),setRecommendedTags:e=>s({recommendedTags:e}),setExistingTags:e=>s({existingTags:e}),setLoading:e=>s({isLoading:e}),setError:e=>s({error:e}),setSuccessMessage:e=>s({successMessage:e}),setLoadingMessage:e=>s({loadingMessage:e}),setIsPublic:n=>{const i=n?"public":"private",t=a(),o=t.config?{...t.config,preferences:{...t.config.preferences,defaultVisibility:i}}:t.config;s({isPublic:n,config:o??t.config});const r=t.config?{...t.config.preferences,defaultVisibility:i}:{theme:"auto",autoSync:!0,syncInterval:24,maxSuggestedTags:5,defaultVisibility:i,enableAI:!0,defaultIncludeThumbnail:!0,defaultCreateSnapshot:!1};e.saveConfig({preferences:r}).catch(()=>{})},setIncludeThumbnail:e=>s({includeThumbnail:e}),setCreateSnapshot:e=>s({createSnapshot:e}),toggleTag:e=>s(s=>({selectedTags:s.selectedTags.includes(e)?s.selectedTags.filter(s=>s!==e):[...s.selectedTags,e]})),addCustomTag:e=>s(s=>s.selectedTags.includes(e)||s.recommendedTags.some(s=>s.name===e)?s:{selectedTags:[...s.selectedTags,e],recommendedTags:[...s.recommendedTags,{name:e,isNew:!0,confidence:1}]}),clearSelectedTags:()=>s({selectedTags:[]}),loadExistingTags:async()=>{try{const e=await t({type:"GET_EXISTING_TAGS"});s({existingTags:e})}catch(e){}},loadConfig:async()=>{try{const a=await e.loadConfig();s({config:a,isPublic:"public"===a.preferences.defaultVisibility,createSnapshot:a.preferences.defaultCreateSnapshot??!1})}catch(a){s({error:"Failed to load configuration"})}},saveConfig:async a=>{try{await e.saveConfig(a);const n=await e.loadConfig();s({config:n,isPublic:"public"===n.preferences.defaultVisibility})}catch(n){s({error:"Failed to save configuration"})}},extractPageInfo:async()=>{try{s({isLoading:!0,error:null});const{config:e}=a(),n=e?.preferences.defaultVisibility??"public",i=e?.preferences.defaultIncludeThumbnail??!0,o=await t({type:"EXTRACT_PAGE_INFO"});s({currentPage:o,isLoading:!1,isPublic:"public"===n,includeThumbnail:i&&Boolean(o.thumbnail)})}catch(e){s({error:e instanceof Error?e.message:"Failed to extract page info",isLoading:!1})}},recommendTags:async()=>{const{currentPage:e}=a();if(!e)return void s({error:"No page info available"});const n=Date.now();try{s({isLoading:!0,isRecommending:!0,error:null,lastRecommendationSource:null,lastRecommendationMessage:null,lastRecommendationDurationMs:null});const i=await t({type:"RECOMMEND_TAGS",payload:e}),o=Date.now()-n,r=i.tags.map(e=>e.name),c={recommendedTags:i.tags,selectedTags:r,isLoading:!1,isRecommending:!1,lastRecommendationSource:i.source,lastRecommendationMessage:i.message||null,lastRecommendationDurationMs:o};if("fallback"===i.source)s({...c,error:i.message?`AI æŽ¨èå¤±è´¥ï¼š${i.message}ã€‚å·²ä½¿ç”¨æœ¬åœ°æŽ¨èæ ‡ç­¾ï¼Œå¯é‡è¯•ã€‚`:"AI æŽ¨èå¤±è´¥ï¼Œå·²ä½¿ç”¨æœ¬åœ°æŽ¨èæ ‡ç­¾ï¼Œå¯é‡è¯•ã€‚"});else{s({...c,error:null});const e=`ðŸŽ¯ AI æŽ¨èå®Œæˆï¼ˆè€—æ—¶ ${(o/1e3).toFixed(2)}sï¼‰`;s({successMessage:e}),setTimeout(()=>{a().successMessage===e&&s({successMessage:null})},2e3)}}catch(i){const e=Date.now()-n;s({error:i instanceof Error?i.message:"Failed to recommend tags",isLoading:!1,isRecommending:!1,lastRecommendationSource:null,lastRecommendationMessage:null,lastRecommendationDurationMs:e})}},saveBookmark:async()=>{const{currentPage:e,selectedTags:n,isPublic:i,includeThumbnail:o,createSnapshot:r}=a();if(!e)return void s({error:"No page info available"});if(0===n.length)return void s({error:"è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ ‡ç­¾"});const c=Date.now();try{s({isLoading:!0,isSaving:!0,error:null});const l=await t({type:"SAVE_BOOKMARK",payload:{url:e.url,title:e.title,description:e.description,tags:n,thumbnail:o?e.thumbnail:void 0,isPublic:i,createSnapshot:r}}),d=Date.now()-c,u=(d/1e3).toFixed(2);if(!l.success)return void s({error:`${l.message||l.error||"ä¿å­˜å¤±è´¥"}ï¼ˆè€—æ—¶ ${u}sï¼‰`,isLoading:!1,isSaving:!1,lastSaveDurationMs:d});if(l.existingBookmark)return void s({existingBookmark:l.existingBookmark,isLoading:!1,isSaving:!1,lastSaveDurationMs:d});let g;l.offline?(g=`${l.message||"ä¹¦ç­¾å·²ç¦»çº¿ä¿å­˜"}ï¼ˆä¿å­˜è€—æ—¶ ${u}sï¼‰`,s({successMessage:g,isLoading:!1,isSaving:!1,lastSaveDurationMs:d}),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:"AI ä¹¦ç­¾åŠ©æ‰‹",message:`${l.message||"ä¹¦ç­¾å·²ç¦»çº¿ä¿å­˜"}ï¼ˆè€—æ—¶ ${u}sï¼‰`})):(g=`âœ… ä¹¦ç­¾ä¿å­˜æˆåŠŸï¼ï¼ˆä¿å­˜è€—æ—¶ ${u}sï¼‰`,s({successMessage:g,isLoading:!1,isSaving:!1,lastSaveDurationMs:d}),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:"AI ä¹¦ç­¾åŠ©æ‰‹",message:`ã€Š${e.title}ã€‹å·²æˆåŠŸä¿å­˜åˆ°ä¹¦ç­¾ï¼ˆè€—æ—¶ ${u}sï¼‰`}));const m=g;setTimeout(()=>{a().successMessage===m&&s({successMessage:null})},2e3)}catch(l){const e=Date.now()-c,a=(e/1e3).toFixed(2);s({error:`${l instanceof Error?l.message:"Failed to save bookmark"}ï¼ˆè€—æ—¶ ${a}sï¼‰`,isLoading:!1,isSaving:!1,lastSaveDurationMs:e})}},updateExistingBookmarkTags:async(e,a)=>{try{s({isSaving:!0,error:null});const n=await t({type:"UPDATE_BOOKMARK_TAGS",payload:{bookmarkId:e,tags:a}});if(!n.success)throw new Error(n.error||"æ›´æ–°æ ‡ç­¾å¤±è´¥");s({successMessage:"âœ… æ ‡ç­¾å·²æ›´æ–°",isSaving:!1,existingBookmark:null}),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:"AI ä¹¦ç­¾åŠ©æ‰‹",message:"æ ‡ç­¾å·²æˆåŠŸæ›´æ–°"}),setTimeout(()=>{s({successMessage:null})},2e3)}catch(n){s({error:n instanceof Error?n.message:"Failed to update tags",isSaving:!1})}},updateExistingBookmarkDescription:async(e,a)=>{try{s({isSaving:!0,error:null});const n=await t({type:"UPDATE_BOOKMARK_DESCRIPTION",payload:{bookmarkId:e,description:a}});if(!n.success)throw new Error(n.error||"æ›´æ–°æè¿°å¤±è´¥");s({successMessage:"âœ… æè¿°å·²æ›´æ–°",isSaving:!1,existingBookmark:null}),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:"AI ä¹¦ç­¾åŠ©æ‰‹",message:"æè¿°å·²æˆåŠŸæ›´æ–°"}),setTimeout(()=>{s({successMessage:null})},2e3)}catch(n){s({error:n instanceof Error?n.message:"Failed to update description",isSaving:!1})}},createSnapshotForBookmark:async e=>{const{currentPage:n}=a();if(n)try{s({isSaving:!0,error:null,loadingMessage:"æ­£åœ¨æ•èŽ·é¡µé¢å†…å®¹...",successMessage:null});const[a]=await chrome.tabs.query({active:!0,currentWindow:!0});a&&a.id&&(await t({type:"CREATE_SNAPSHOT",payload:{bookmarkId:e,title:n.title,url:n.url}}),s({successMessage:"å¿«ç…§å·²åˆ›å»º",loadingMessage:null,isSaving:!1,existingBookmark:null}),chrome.notifications.create({type:"basic",iconUrl:"/icons/icon-128.png",title:"AI ä¹¦ç­¾åŠ©æ‰‹",message:"å¿«ç…§å·²æˆåŠŸåˆ›å»º"}),setTimeout(()=>{s({successMessage:null})},3e3))}catch(i){s({error:i instanceof Error?i.message:"Failed to create snapshot",loadingMessage:null,isSaving:!1})}},syncCache:async()=>{try{s({isLoading:!0,error:null}),await t({type:"SYNC_CACHE"}),s({successMessage:"Cache synced successfully!",isLoading:!1}),setTimeout(()=>{s({successMessage:null})},2e3)}catch(e){s({error:e instanceof Error?e.message:"Failed to sync cache",isLoading:!1})}}}));async function t(e){return new Promise((s,a)=>{chrome.runtime.sendMessage(e,e=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message)):e.success?s(e.data):a(new Error(e.error||"Unknown error"))})})}function o(){return a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[color:var(--tab-message-info-icon)]"})})}function r({message:e,onDismiss:s,onRetry:n}){return a.jsx("div",{className:"bg-[color:var(--tab-message-danger-bg)] border border-[color:var(--tab-message-danger-border)] rounded-lg p-3 shadow-lg animate-in slide-in-from-top-5 fade-in duration-300 text-[var(--tab-message-danger-icon)]",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"bg-[color:var(--tab-message-danger-icon-bg)] rounded-full p-1.5 flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-[var(--tab-message-danger-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("div",{className:"flex-1 pt-0.5",children:a.jsx("p",{className:"text-sm font-medium",children:e})}),a.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[n&&a.jsx("button",{onClick:n,className:"text-[var(--tab-message-danger-icon)] hover:opacity-90 text-xs font-medium transition-colors",children:"é‡è¯•"}),s&&a.jsx("button",{onClick:s,className:"opacity-80 hover:opacity-100 transition-opacity",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})})}function c({message:e,onDismiss:s,autoHideDuration:i=3e3}){return n.useEffect(()=>{if(s&&i>0){const e=setTimeout(()=>{s()},i);return()=>{clearTimeout(e)}}},[s,i]),a.jsx("div",{className:"bg-[color:var(--tab-message-success-bg)] border border-[color:var(--tab-message-success-border)] rounded-lg p-3 shadow-lg animate-in slide-in-from-top-5 fade-in duration-300 text-[var(--tab-message-success-icon)]",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"bg-[color:var(--tab-message-success-icon-bg)] rounded-full p-1.5 flex-shrink-0",children:a.jsx("svg",{className:"w-5 h-5 text-[var(--tab-message-success-icon)]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsx("div",{className:"flex-1 pt-0.5",children:a.jsx("p",{className:"text-sm font-medium",children:e})}),s&&a.jsx("button",{onClick:s,className:"flex-shrink-0 opacity-80 hover:opacity-100 transition-opacity",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}const l={default:"theme-default",bw:"theme-bw",tmarks:"theme-tmarks"};function d(e){const s=document.documentElement;Object.values(l).forEach(e=>s.classList.remove(e)),s.classList.add(l[e])}function u(e){const s=document.documentElement;if("dark"===e)s.classList.add("dark");else if("light"===e)s.classList.remove("dark");else{window.matchMedia("(prefers-color-scheme: dark)").matches?s.classList.add("dark"):s.classList.remove("dark")}}function g(e){const s=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{"auto"===e()&&u("auto")};return s.addEventListener("change",a),u(e()),()=>s.removeEventListener("change",a)}export{r as E,o as L,c as S,u as a,d as b,g as i,i as u};
