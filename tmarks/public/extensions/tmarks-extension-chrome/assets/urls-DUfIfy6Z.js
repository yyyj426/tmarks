const e={provider:"openai",apiKeys:{},apiUrls:{},model:"gpt-4o",enableCustomPrompt:!1,customPrompt:void 0},t={apiUrl:"",apiKey:""},a={theme:"auto",themeStyle:"default",autoSync:!0,syncInterval:24,maxSuggestedTags:5,defaultVisibility:"public",enableAI:!0,defaultIncludeThumbnail:!0,defaultCreateSnapshot:!1,tagTheme:"classic"},i=()=>({aiConfig:{provider:e.provider,apiKeys:{...e.apiKeys},apiUrls:{...e.apiUrls},model:e.model,enableCustomPrompt:e.enableCustomPrompt,customPrompt:e.customPrompt,savedConnections:{}},bookmarkSite:{...t},preferences:{...a}});class o{static STORAGE_KEY="config";static configCache=null;static initialized=!1;static cloneSavedConnections(e){const t={};return e?(Object.entries(e).forEach(([e,a])=>{Array.isArray(a)&&(t[e]=a.map(e=>({...e})))}),t):t}static mergeWithDefaults(e){const t=i();return e?{aiConfig:{provider:e.aiConfig?.provider||t.aiConfig.provider,apiKeys:{...t.aiConfig.apiKeys,...e.aiConfig?.apiKeys||{}},apiUrls:{...t.aiConfig.apiUrls,...e.aiConfig?.apiUrls||{}},model:e.aiConfig?.model??t.aiConfig.model,customPrompt:e.aiConfig?.customPrompt??t.aiConfig.customPrompt,enableCustomPrompt:e.aiConfig?.enableCustomPrompt??t.aiConfig.enableCustomPrompt,savedConnections:{...t.aiConfig.savedConnections||{},...e.aiConfig?.savedConnections||{}}},bookmarkSite:{apiUrl:e.bookmarkSite?.apiUrl??t.bookmarkSite.apiUrl,apiKey:e.bookmarkSite?.apiKey??t.bookmarkSite.apiKey},preferences:{theme:e.preferences?.theme??t.preferences.theme,themeStyle:e.preferences?.themeStyle??t.preferences.themeStyle,autoSync:e.preferences?.autoSync??t.preferences.autoSync,syncInterval:e.preferences?.syncInterval??t.preferences.syncInterval,maxSuggestedTags:e.preferences?.maxSuggestedTags??t.preferences.maxSuggestedTags,defaultVisibility:e.preferences?.defaultVisibility??t.preferences.defaultVisibility,enableAI:e.preferences?.enableAI??t.preferences.enableAI,defaultIncludeThumbnail:e.preferences?.defaultIncludeThumbnail??t.preferences.defaultIncludeThumbnail,defaultCreateSnapshot:e.preferences?.defaultCreateSnapshot??t.preferences.defaultCreateSnapshot,tagTheme:e.preferences?.tagTheme??t.preferences.tagTheme,newtabFolderRecommendCount:e.preferences?.newtabFolderRecommendCount??t.preferences.newtabFolderRecommendCount,enableNewtabAI:e.preferences?.enableNewtabAI??t.preferences.enableNewtabAI,enableNewtabFolderPrompt:e.preferences?.enableNewtabFolderPrompt??t.preferences.enableNewtabFolderPrompt,newtabFolderPrompt:e.preferences?.newtabFolderPrompt??t.preferences.newtabFolderPrompt}}:t}static ensureInitialized(){this.initialized||(chrome.storage.onChanged.addListener((e,t)=>{if("local"!==t)return;const a=e[this.STORAGE_KEY];a&&(this.configCache=this.mergeWithDefaults(a.newValue))}),this.initialized=!0)}static async loadConfig(){if(this.ensureInitialized(),this.configCache)return this.configCache;try{const e=await chrome.storage.local.get([this.STORAGE_KEY]),t=this.mergeWithDefaults(e[this.STORAGE_KEY]);return this.configCache=t,t}catch(e){const t=i();return this.configCache=t,t}}static async saveConfig(e){try{const t=await this.loadConfig();let a;a=Boolean(e.aiConfig&&Object.prototype.hasOwnProperty.call(e.aiConfig,"savedConnections"))?this.cloneSavedConnections(e.aiConfig?.savedConnections):this.cloneSavedConnections({...t.aiConfig.savedConnections||{},...e.aiConfig?.savedConnections||{}});const{savedConnections:i,...o}=e.aiConfig||{},n={...t,...e,aiConfig:{...t.aiConfig,...o,savedConnections:a},bookmarkSite:{...t.bookmarkSite,...e.bookmarkSite||{}},preferences:{...t.preferences,...e.preferences||{}}};await chrome.storage.local.set({[this.STORAGE_KEY]:n}),this.configCache=this.mergeWithDefaults(n)}catch(t){throw t}}static async getAIApiKey(){const e=await this.loadConfig(),t=e.aiConfig.provider;return e.aiConfig.apiKeys[t]}static async setAIApiKey(e,t){const a=await this.loadConfig();await this.saveConfig({aiConfig:{...a.aiConfig,apiKeys:{...a.aiConfig.apiKeys,[e]:t}}})}static async getBookmarkSiteApiKey(){return(await this.loadConfig()).bookmarkSite.apiKey}static async getBookmarkSiteApiUrl(){return(await this.loadConfig()).bookmarkSite.apiUrl}static async getTMarksConfig(){const e=await this.loadConfig();return{bookmarkApiUrl:e.bookmarkSite.apiUrl,bookmarkApiKey:e.bookmarkSite.apiKey}}static async clear(){await chrome.storage.local.clear(),this.configCache=null}}const n={DEFAULT_BASE_URL:"https://tmarks.669696.xyz",DEFAULT_API_BASE:"https://tmarks.669696.xyz/api"};function s(e){const t=(e||n.DEFAULT_BASE_URL).replace(/\/$/,"");return{BASE_URL:t,API_BASE:`${t}/api`,WEB_APP:`${t}/`,TAB_GROUPS:`${t}/tab`}}function r(e){if(!e)return n.DEFAULT_API_BASE;const t=e.trim().replace(/\/+$/,"");return t.endsWith("/api")?t:`${t}/api`}const c={OPENAI:"https://api.openai.com/v1",CLAUDE:"https://api.anthropic.com/v1",DEEPSEEK:"https://api.deepseek.com/v1",ZHIPU:"https://open.bigmodel.cn/api/paas/v4",MODELSCOPE:"https://api-inference.modelscope.cn/v1",SILICONFLOW:"https://api.siliconflow.cn/v1",IFLOW:"https://apis.iflow.cn/v1"},p={OPENAI:"https://platform.openai.com/api-keys",CLAUDE:"https://console.anthropic.com/",DEEPSEEK:"https://platform.deepseek.com/api_keys",ZHIPU:"https://open.bigmodel.cn/usercenter/apikeys",MODELSCOPE:"https://www.modelscope.cn/my/myaccesstoken",SILICONFLOW:"https://cloud.siliconflow.cn/account/ak",IFLOW:"https://console.xfyun.cn/services/iat"},l={GOOGLE_FAVICON:"https://www.google.com/s2/favicons"},f={DEFAULT_PAGE_SIZE:100,MAX_PAGES:100};export{p as A,l as E,f as P,o as S,n as T,c as a,s as g,r as n};
